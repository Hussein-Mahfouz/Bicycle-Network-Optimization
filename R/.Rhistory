by = c("MSOA11CD" = "msoa11cd")) %>% st_as_sf() %>% st_make_valid() %>%
mutate(centroid = st_centroid(geometry))  # we will need centroids to calculate distance matrix
# Add spatial data to london msoas
spatial_london <- msoas_london[, c("MSOA11CD", "MSOA11NM")] %>% left_join(msoa_boundaries[ , c("msoa11cd", "geometry")],
by = c("MSOA11CD" = "msoa11cd")) %>% st_as_sf() %>% lwgeom::st_make_valid() %>%
mutate(centroid = st_centroid(geometry))  # we will need centroids to calculate distance matrix
View(spatial_london)
#import spatial data using API: https://geoportal.statistics.gov.uk/datasets/826dc85fb600440889480f4d9dbb1a24_0
#msoa_boundaries <- st_read('https://opendata.arcgis.com/datasets/826dc85fb600440889480f4d9dbb1a24_0.geojson')
# or download it locally and read it (faster)
msoa_boundaries <- st_read('../data-raw/MSOA_2011_Boundaries/Middle_Layer_Super_Output_Areas__December_2011__Boundaries.shp') %>%
st_transform(4326)
msoa_boundaries
# Add spatial data to london msoas
spatial_london <- msoas_london[, c("MSOA11CD", "MSOA11NM")] %>% left_join(msoa_boundaries[ , c("msoa11cd", "geometry")],
by = c("MSOA11CD" = "msoa11cd")) %>% st_as_sf() %>% lwgeom::st_make_valid() %>%
mutate(centroid = st_centroid(geometry))  # we will need centroids to calculate distance matrix
View(spatial_london)
class(spatial_london)
df <- subset(spatial_london, select = -c('geometry'))
df <- subset(spatial_london, select = -c(geometry))
View(df)
df$geometry
df2 <- st_drop_geometry(spatial_london)
View(df2)
class(df2)
df2$centroid
df3 <- st_drop_geometry(spatial_london) %>% st_set_geometry(centroid)
df3 <- st_drop_geometry(spatial_london) %>% st_set_geometry('centroid')
class(df3)
plot(st_geometry(df3))
View(df3)
st_write(df3, "../data/msoa_centroids.geojson")
cent <- st_read("../data/msoa_centroids.geojson")
View(cent)
# save the output for routing later
st_drop_geometry(spatial_london) %>% st_set_geometry('centroid') %>%
st_write("../data/msoa_centroids.geojson")
cent2 <- st_read("../data/msoa_centroids.geojson")
rm(cent, cent2)
rm(df, df2, df3)
View(spatial_london)
# load msoa centroid geojson
msoa_centroids <- st_read("../data/msoa_centroids.geojson")
View(msoa_centroids)
# function to split c(lat, lon) to two seperate columns  FROM JM London (https://github.com/r-spatial/sf/issues/231)
# lat = Y lon = X
split_lon_lat <- function(x, names = c("lon","lat")) {
stopifnot(inherits(x,"sf") && inherits(sf::st_geometry(x),"sfc_POINT"))
ret <- sf::st_coordinates(x)
ret <- tibble::as_tibble(ret)
stopifnot(length(names) == ncol(ret))
x <- x[ , !names(x) %in% names]
ret <- setNames(ret,names)
dplyr::bind_cols(x,ret)
}
# add lon and lat columns to dataframe using sfc_as_cols function
msoa_centroids <- split_lon_lat(msoa_centroids)
View(msoa_centroids)
xy <- rbind (c (7.005994, 51.45774), # limbeckerplatz 1 essen germany
c (7.012874, 51.45041)) # hauptbahnhof essen germany
View(xy)
xy <- data.frame (lon = xy [, 1], lat = xy [, 2])
View(xy)
rm(xy)
x <- select(msoa_centroids, c(lon, lat))
View(x)
# load msoa centroid geojson
msoa_centroids <- st_read("../data/msoa_centroids.geojson")
# add lon and lat columns to dataframe using sfc_as_cols function
msoa_centroids <- split_lon_lat(msoa_centroids) %>% st_drop_geometry() %>%
select(c(lon, lat))
View(msoa_centroids)
rm(x)
# route
graph_contracted <- dodgr_contract_graph(graph)
nrows(graph)
nrow(graph)
nrow(graph_contracted)
d <- dodgr_dists (graph_contracted, from = msoa_centroids, to = msoa_centroids)
View(d)
# load msoa centroid geojson
msoa_centroids_x <- st_read("../data/msoa_centroids.geojson")
View(msoa_centroids_x)
graphxx <- data.frame (from = c ("A", "B", "B", "B", "C", "C", "D", "D"),
to = c ("B", "A", "C", "D", "B", "D", "C", "A"),
d = c (1, 2, 1, 3, 2, 1, 2, 1))
View(graphxx)
rm(graphxx)
View(msoa_centroids)
# flow data from the 2011 census https://www.nomisweb.co.uk/census/2011/bulk/rOD1
flows <- read_csv('../data-raw/flow_data.csv')
View(flows)
d{1}
d[1]
d[1,]
d[,1]
d[1,1:3]
colnamess(d) <- msoa_centroids_x$MSOA11CD
colnames(d) <- msoa_centroids_x$MSOA11CD
View(d)
r
rownames(d) <- msoa_centroids_x$MSOA11CD
View(d)
class(d)
dd <- as.data.frame(d)
View(dd)
class(dd)
?pivot_longer
ddd <- pivot_longer(d)
ddd <- pivot_longer(dd)
msoa_centroids_x$MSOA11CD
ddd <-cbind(msoa_centroids_x$MSOA11CD, dd)
View(ddd)
colnames(ddd)
dddd %>% ddd %>%
pivot_longer("msoa_centroids_x$MSOA11CD")
dddd <- ddd %>%
pivot_longer("msoa_centroids_x$MSOA11CD")
View(dddd)
dddd <- ddd %>%
pivot_longer(`msoa_centroids_x$MSOA11CD`, names_to = "to", values_to = "dist")
View(dddd)
dddd <- ddd %>%
pivot_longer(-`msoa_centroids_x$MSOA11CD`, names_to = "to", values_to = "dist")
View(dddd)
# this is a lookup table matching MSOAs to major towns and cities
city_names <- read_csv('../data-raw/Middle_Layer_Super_Output_Area__2011__to_Major_Towns_and_Cities__December_2015__Lookup_in_England_and_Wales.csv')
# change column name
city_names <- city_names %>% rename(city = TCITY15NM)
# flow data from the 2011 census https://www.nomisweb.co.uk/census/2011/bulk/rOD1
flows <- read_csv('../data-raw/flow_data.csv')
View(flows)
# add a column with the city name corresponding to each Residence MSOA
flows <- flows %>% left_join(city_names[,c("MSOA11CD", "city")],
by = c("Area of residence" = "MSOA11CD")) %>%
rename(city_origin = city) # rename column so that we know it is referring to the 'Area of residence'
# add a column with the city name corresponding to each Workplace MSOA
flows <- flows %>% left_join(city_names[,c("MSOA11CD", "city")],
by = c("Area of workplace" = "MSOA11CD")) %>%
rename(city_dest = city) # rename column so that we know it is referring to the 'Area of workplace'
flows_internal <- function(name) {
x <- flows %>% filter(city_origin == name, city_dest == name)
return(x)
}
# use function to get flows between all MSOAs in London
flows_london <- flows_internal("London")
View(flows_london)
#import spatial data using API: https://geoportal.statistics.gov.uk/datasets/826dc85fb600440889480f4d9dbb1a24_0
#msoa_boundaries <- st_read('https://opendata.arcgis.com/datasets/826dc85fb600440889480f4d9dbb1a24_0.geojson')
# or download it locally and read it (faster)
msoa_boundaries <- st_read('../data-raw/MSOA_2011_Boundaries/Middle_Layer_Super_Output_Areas__December_2011__Boundaries.shp') %>%
st_transform(4326)   # transform to EPSG 4326 for dodgr routing later
# function to filter MSOAs that are within a certain city
msoas_city <- function(name) {
x <- city_names %>% filter(city == name)
return(x)
}
# get msoas in London
msoas_london <- msoas_city("London")
View(msoas_london)
# Add spatial data to london msoas
spatial_london <- msoas_london[, c("MSOA11CD", "MSOA11NM")] %>% left_join(msoa_boundaries[ , c("msoa11cd", "geometry")],
by = c("MSOA11CD" = "msoa11cd")) %>% st_as_sf() %>% lwgeom::st_make_valid() %>%
mutate(centroid = st_centroid(geometry))  # we will need centroids to calculate distance matrix
View(spatial_london)
# add geometry of origin
flows_london <- flows_london %>% left_join(spatial_london[ , c("MSOA11CD", "geometry", "centroid")],
by = c("Area of residence" = "MSOA11CD")) %>%
rename(geom_orig = geometry, cent_orig = centroid)
View(msoa_centroids)
# read in the data
flow <- readr::read_csv("../data/msoa_distances.csv")
View(flow)
View(flows)
View(msoa_centroids_x)
View(d)
class(d)
dx <- cbind(msoa_centroids_x$MSOA11CD, d)
View(dx)
View(msoa_centroids_x)
dx <- cbind(msoa_centroids_x$MSOA11CD, dd)
View(dx)
View(dddd)
View(ddd)
View(ddd)
#import spatial data using API: https://geoportal.statistics.gov.uk/datasets/826dc85fb600440889480f4d9dbb1a24_0
#msoa_boundaries <- st_read('https://opendata.arcgis.com/datasets/826dc85fb600440889480f4d9dbb1a24_0.geojson')
# or download it locally and read it (faster)
msoa_boundaries <- st_read('../data-raw/MSOA_2011_Boundaries/Middle_Layer_Super_Output_Areas__December_2011__Boundaries.shp') %>%
st_transform(4326)   # transform to EPSG 4326 for dodgr routing later
# function to filter MSOAs that are within a certain city
msoas_city <- function(name) {
x <- city_names %>% filter(city == name)
return(x)
}
# get msoas in London
msoas_london <- msoas_city("London")
# Add spatial data to london msoas
spatial_london <- msoas_london[, c("MSOA11CD", "MSOA11NM")] %>% left_join(msoa_boundaries[ , c("msoa11cd", "geometry")],
by = c("MSOA11CD" = "msoa11cd")) %>% st_as_sf() %>% lwgeom::st_make_valid() %>%
mutate(centroid = st_centroid(geometry))  # we will need centroids to calculate distance matrix
# save the output for routing later. Remove borders and set centroids as geometry, then save
# this does not overwrite 'spatial_london' sf
msoa_centroids <- st_drop_geometry(spatial_london) %>% st_set_geometry('centroid')
View(msoa_centroids)
# function to split c(lat, lon) to two seperate columns  FROM JM London (https://github.com/r-spatial/sf/issues/231)
# lat = Y lon = X
split_lon_lat <- function(x, names = c("lon","lat")) {
stopifnot(inherits(x,"sf") && inherits(sf::st_geometry(x),"sfc_POINT"))
ret <- sf::st_coordinates(x)
ret <- tibble::as_tibble(ret)
stopifnot(length(names) == ncol(ret))
x <- x[ , !names(x) %in% names]
ret <- setNames(ret,names)
dplyr::bind_cols(x,ret)
}
# add lon and lat columns to dataframe using sfc_as_cols function
msoa_centroids %>% split_lon_lat() %>% st_drop_geometry() %>%
select(c(lon, lat))
View(msoa_centroids)
class(d)
d <- as.data.frame(d)
d
class(d)
View(d)
# get distance matrix
d <- dodgr_dists(graph_contracted, from = msoa_centroids, to = msoa_centroids) %>% as.data.frame()
View(msoa_centroids)
View(msoa_centroids)
# add lon and lat columns to dataframe using sfc_as_cols function
msoa_centroids %>% split_lon_lat() %>% st_drop_geometry() %>%
select(c(lon, lat))
View(msoa_centroids)
# add lon and lat columns to dataframe using sfc_as_cols function
msoa_centroids <- msoa_centroids %>% split_lon_lat() %>% st_drop_geometry() %>%
select(c(lon, lat))
# get distance matrix
d <- dodgr_dists(graph_contracted, from = msoa_centroids, to = msoa_centroids) %>% as.data.frame()
View(d)
class(d)
# Change column names for pivoting
colnames(d) <- msoa_centroids_x$MSOA11CD
# column bind to add MSOA IDs to df. If this is done using rownames then then it is added as a column index (cannot pivot)
d <- cbind(msoa_centroids_x$MSOA11CD, d) %>% rename(from = `msoa_centroids_x$MSOA11CD`)
# Change to long format to merge with flows
d <- d %>%
pivot_longer(-from, names_to = "to", values_to = "dist")
View(d)
View(msoa_centroids)
View(msoa_centroids_x)
hist(d$dist)
tezt <- dodgr_dists(graph_contracted, from = msoa_centroids, to = msoa_centroids) %>% as.data.frame()
View(tezt)
#tezt <- dodgr_dists(graph_contracted, from = msoa_centroids, to = msoa_centroids) %>% as.data.frame()
colnames(tezt) <- msoa_centroids_x$MSOA11CD
tezt <- cbind(msoa_centroids_x$MSOA11CD, tezt) %>% rename(from = `msoa_centroids_x$MSOA11CD`)
View(msoa_centroids)
View(msoa_centroids_x)
# save the output for routing later. Remove borders and set centroids as geometry, then save
# this does not overwrite 'spatial_london' sf
msoa_centroids_x <- st_drop_geometry(spatial_london) %>% st_set_geometry('centroid')
View(msoa_centroids_x)
View(spatial_london)
View(graph_contracted)
View(d)
View(flows_london)
View(spatial_london)
# add geometry of destination
flows_london <- flows_london %>% left_join(spatial_london[ , c("MSOA11CD", "geometry", "centroid")],
by = c("Area of workplace" = "MSOA11CD")) %>%
rename(geom_dest = geometry, cent_dest = centroid)
sf_dist <- read_csv("../data/msoa_distances.csv")
View(sf_dist)
sf_dist <- read_csv("../data/msoa_distances.csv") %>% subset(select = c(`Area of residence`, `Area of workplace`, dist))
sf_dist <- read_csv("../data/msoa_distances.csv") %>%
subset(select = c(`Area of residence`, `Area of workplace`, dist)) %>%
rename(dist_sf = dist)
whatever <- left_join(d, sf, by = c("from" = "Area of Residence", "to" = "Area of Workplace"))
whatever <- left_join(d, dist_sf, by = c("from" = "Area of Residence", "to" = "Area of Workplace"))
whatever <- left_join(d, sf_dist, by = c("from" = "Area of Residence", "to" = "Area of Workplace"))
whatever <- left_join(d, sf_dist, by = c("from" = "Area of residence", "to" = "Area of workplace"))
View(whatever)
View(d)
View(flow)
View(sf_dist)
View(flows_london)
View(flows)
View(msoas_london)
flows_london2 <- left_join(flows_london, d, by = c("Area of residence" = "from" , "Area of workplace" = "to"))
View(flows_london2)
View(flows_london2)
View(msoas_london)
View(msoa_centroids_x)
View(sf_dist)
rm(whatever, tezt)
rm(flows_london2)
rm(dddd)
rm(ddd)
rm(dx)
rm(flows)
rm(flows_internal())
rm(flows_internal)
rm(flows_london)
rm(city_names)
rm(msoa_boundaries)
rm(msoa_centroids)
rm(msoa_centroids_x)
rm(msoas_london)
rm(spatial_london)
View(dd)
View(d)
rm(dd)
rm(d)
View(flow)
rm(flow)
rm(sf_dist)
rm(msoas_city())
rm(msoas_city)
rm(split_lon_lat)
# this is a lookup table matching MSOAs to major towns and cities
city_names <- read_csv('../data-raw/Middle_Layer_Super_Output_Area__2011__to_Major_Towns_and_Cities__December_2015__Lookup_in_England_and_Wales.csv')
# change column name
city_names <- city_names %>% rename(city = TCITY15NM)
# flow data from the 2011 census https://www.nomisweb.co.uk/census/2011/bulk/rOD1
flows <- read_csv('../data-raw/flow_data.csv')
# add a column with the city name corresponding to each Residence MSOA
flows <- flows %>% left_join(city_names[,c("MSOA11CD", "city")],
by = c("Area of residence" = "MSOA11CD")) %>%
rename(city_origin = city) # rename column so that we know it is referring to the 'Area of residence'
# add a column with the city name corresponding to each Workplace MSOA
flows <- flows %>% left_join(city_names[,c("MSOA11CD", "city")],
by = c("Area of workplace" = "MSOA11CD")) %>%
rename(city_dest = city) # rename column so that we know it is referring to the 'Area of workplace'
View(flows)
flows_internal <- function(name) {
x <- flows %>% filter(city_origin == name, city_dest == name)
return(x)
}
# use function to get flows between all MSOAs in London
flows_london <- flows_internal("London")
# save as csv to use in next step
write_csv(flows_london, path = "../data/flows_london.csv")
View(flows_london)
# remove variables from global environment
rm(flows, flows_london)
#import spatial data using API: https://geoportal.statistics.gov.uk/datasets/826dc85fb600440889480f4d9dbb1a24_0
#msoa_boundaries <- st_read('https://opendata.arcgis.com/datasets/826dc85fb600440889480f4d9dbb1a24_0.geojson')
# or download it locally and read it (faster)
msoa_boundaries <- st_read('../data-raw/MSOA_2011_Boundaries/Middle_Layer_Super_Output_Areas__December_2011__Boundaries.shp') %>%
st_transform(4326)   # transform to EPSG 4326 for dodgr routing later
View(city_names)
# function to filter MSOAs that are within a certain city
msoas_city <- function(name) {
x <- city_names %>% filter(city == name)
return(x)
}
# get msoas in London
msoas_london <- msoas_city("London")
# Add spatial data to london msoas
spatial_london <-
msoas_london[, c("MSOA11CD", "MSOA11NM")] %>%
left_join(msoa_boundaries[ , c("msoa11cd", "geometry")], by = c("MSOA11CD" = "msoa11cd")) %>%
st_as_sf() %>% lwgeom::st_make_valid() %>%
mutate(centroid = st_centroid(geometry))  # we will need centroids to calculate distance matrix
View(spatial_london)
# Remove border geometry and set centroids as geometry. This does not overwrite 'spatial_london' sf
msoa_centroids <-
st_drop_geometry(spatial_london) %>%
st_set_geometry('centroid')
View(msoa_centroids)
# function to split c(lat, lon) to two seperate columns  FROM JM London (https://github.com/r-spatial/sf/issues/231)
# lat = Y lon = X
split_lon_lat <- function(x, names = c("lon","lat")) {
stopifnot(inherits(x,"sf") && inherits(sf::st_geometry(x),"sfc_POINT"))
ret <- sf::st_coordinates(x)
ret <- tibble::as_tibble(ret)
stopifnot(length(names) == ncol(ret))
x <- x[ , !names(x) %in% names]
ret <- setNames(ret,names)
dplyr::bind_cols(x,ret)
}
View(msoa_centroids)
# add lon and lat columns to dataframe using sfc_as_cols function
msoa_lon_lat <- msoa_centroids %>% split_lon_lat() %>% st_drop_geometry() %>%
select(c(lon, lat))
View(msoa_centroids)
View(msoa_lon_lat)
#save the data so that you don't have to do this again
readr::write_csv(graph, path = "../data/weighted_graph.csv")
x <- read_csv('../data/weighted_graph.csv')
# contract graph for faster routing
graph_contracted2 <- dodgr_contract_graph(x)
identical(graph_contracted, graph_contracted2)
class(graph_contracted)
class(graph_contracted2)
d2 <- dodgr_dists(graph_contracted2, from = msoa_lon_lat, to = msoa_lon_lat) %>% as.data.frame()
View(d2)
# get distance matrix
d <- dodgr_dists(graph_contracted, from = msoa_lon_lat, to = msoa_lon_lat) %>% as.data.frame()
identical(d, d2)
d == d2
rm(d2)
rm(graph_contracted2)
View(d)
rm(d)
# get distance matrix
dist_mat <- dodgr_dists(graph_contracted, from = msoa_lon_lat, to = msoa_lon_lat) %>% as.data.frame()
View(dist_mat)
View(dist_mat)
# Change column names for pivoting
colnames(dist_mat) <- msoa_centroids$MSOA11CD
View(msoa_centroids)
# column bind to add MSOA IDs to df. If this is done using rownames then then it is added as a column index (cannot pivot)
dist_mat <- cbind(msoa_centroids$MSOA11CD, dist_mat) %>% rename(from = `msoa_centroids$MSOA11CD`)
# Change to long format to merge with flows
dist_mat <- dist_mat %>%
pivot_longer(-from, names_to = "to", values_to = "dist")
View(dist_mat)
flows_london <- read_csv("../data/flows_london.csv")
View(flows_london)
flows_london <- read_csv("../data/flows_london.csv") %>%
subset(select = -c(city_origin, city_dest))
# add geometry of origin
flows_london <- flows_london %>% left_join(spatial_london[ , c("MSOA11CD", "geometry", "centroid")],
by = c("Area of residence" = "MSOA11CD")) %>%
rename(geom_orig = geometry, cent_orig = centroid)
View(flows_london)
# add geometry of destination
flows_london <- flows_london %>% left_join(spatial_london[ , c("MSOA11CD", "geometry", "centroid")],
by = c("Area of workplace" = "MSOA11CD")) %>%
rename(geom_dest = geometry, cent_dest = centroid)
# get straight line distances - this takes TIMMEEEE
flows_london <- flows_london %>%
mutate(dist =st_distance(cent_orig, cent_dest, by_element = T))
View(flows_london)
# Create dataframe with both straight line distances and dodgr distance
distances <- flows_london %>%
subset(select = -c(geom_orig, geom_dest, cent_orig, cent_dest)) %>%
subset(select = c(`Area of residence`, `Area of workplace`, dist)) %>%
rename(dist_strait = dist) %>%
left_join(dist_mat, by = c("Area of residence" = "from", "Area of workplace" = "to"))
View(distances)
distances <- flows_london %>%
subset(select = -c(geom_orig, geom_dest, cent_orig, cent_dest)) %>%
subset(select = c(`Area of residence`, `Area of workplace`, dist)) %>%
rename(dist_strait = dist) %>%
right_join(dist_mat, by = c("from" = "Area of residence", "to" = "Area of workplace"))
distances2 <- flows_london %>%
subset(select = -c(geom_orig, geom_dest, cent_orig, cent_dest)) %>%
subset(select = c(`Area of residence`, `Area of workplace`, dist)) %>%
rename(dist_strait = dist) %>%
right_join(dist_mat, by = c("Area of residence" = "from" , "Area of workplace" = "to"))
View(distances2)
rm(distances2)
# Create dataframe with both straight line distances and dodgr distance
distances <- flows_london %>%
subset(select = -c(geom_orig, geom_dest, cent_orig, cent_dest)) %>%
subset(select = c(`Area of residence`, `Area of workplace`, dist)) %>%
rename(dist_straight = dist) %>%
left_join(dist_mat, by = c("Area of residence" = "from", "Area of workplace" = "to"))
View(distances)
# Create dataframe with both straight line distances and dodgr distance
distances <- flows_london %>%
subset(select = -c(geom_orig, geom_dest, cent_orig, cent_dest)) %>%
subset(select = c(`Area of residence`, `Area of workplace`, dist)) %>%
rename(dist_straight = dist) %>%
left_join(dist_mat, by = c("Area of residence" = "from", "Area of workplace" = "to")) %>%
rename(dist_dodgr = dist) %>%
distances2 <- flows_london %>%
subset(select = -c(geom_orig, geom_dest, cent_orig, cent_dest)) %>%
subset(select = c(`Area of residence`, `Area of workplace`, dist)) %>%
rename(dist_strait = dist) %>%
right_join(dist_mat, by = c("Area of residence" = "from" , "Area of workplace" = "to"))
# Create dataframe with both straight line distances and dodgr distance
distances <- flows_london %>%
subset(select = -c(geom_orig, geom_dest, cent_orig, cent_dest)) %>%
subset(select = c(`Area of residence`, `Area of workplace`, dist)) %>%
rename(dist_straight = dist) %>%
left_join(dist_mat, by = c("Area of residence" = "from", "Area of workplace" = "to")) %>%
rename(dist_dodgr = dist)
View(distances)
# save for reference
write_csv(distances, path = "../data/dist_straight_vs_dodgr.csv")
View(dist_mat)
# left join with flows df. Flows df has less rows because it is a sparce matrix (not all OD pairs have flows)
x <- flows_london %>% subset(select = -c(geom_orig, cent_orig, geom_dest, cent_dest)) %>%
left_join(dist_mat, by = c("Area of residence" = "from" , "Area of workplace" = "to")) #%>%
View(x)
# left join with flows df. Flows df has less rows because it is a sparce matrix (not all OD pairs have flows)
x <- flows_london %>% subset(select = -c(geom_orig, cent_orig, geom_dest, cent_dest, dist)) %>%
left_join(dist_mat, by = c("Area of residence" = "from" , "Area of workplace" = "to")) #%>%
View(x)
# left join with flows df. Flows df has less rows because it is a sparce matrix (not all OD pairs have flows)
flows_london %>% subset(select = -c(geom_orig, cent_orig, geom_dest, cent_dest, dist)) %>%
left_join(dist_mat, by = c("Area of residence" = "from" , "Area of workplace" = "to")) %>%
write_csv(path = "../data/flows_dist_for_potential_flow.csv")
x <- read_csv("../data/flows_dist_for_potential_flow.csv")
View(x)
rm(x)
View(dist_mat)
View(distances)
View(msoa_boundaries)
View(msoa_centroids)
View(msoa_lon_lat)
View(msoa_centroids)
View(spatial_london)
View(msoa_centroids)
# remove variables from global environment
rm(city_names, dist_mat, distances, msoa_boundaries, spatial_london)
View(msoas_london)
rm(msoas_london)
